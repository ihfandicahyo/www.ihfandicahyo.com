<style>
  /* Bingkai Utama berbasis MedianUI */
  #random-post-daily {
    display: none;
    margin: 20px 0;
    padding: 15px;
    background: var(--content-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    position: relative;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    animation: fadeInUp 0.6s ease-out forwards;
  }

  /* Ornamen Sudut Gaya Bali */
  .rp-ornament {
    position: absolute;
    width: 45px;
    height: 45px;
    fill: #8875F5;
    z-index: 2;
    pointer-events: none;
    opacity: 0.8;
  }
  .orn-tl { top: -1px; left: -1px; }
  .orn-br { bottom: -1px; right: -1px; transform: rotate(180deg); }

  /* Garis Dekorasi Interior */
  #random-post-daily::before {
    content: '';
    position: absolute;
    top: 6px; left: 6px; right: 6px; bottom: 6px;
    border: 1px solid #8875F5;
    opacity: 0.15;
    pointer-events: none;
    border-radius: 8px;
  }

  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .rp-inner { position: relative; z-index: 3; }
  .rp-header {
    font-size: 10px;
    font-weight: 700;
    color: #8875F5;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-align: center;
    margin-bottom: 12px;
  }

  #rp-content { display: flex; gap: 15px; text-decoration: none; align-items: center; color: var(--text-color); }
  
  /* Frame Gambar Latar Belakang */
  .rp-img-frame {
    width: 75px;
    height: 75px;
    border-radius: 8px;
    overflow: hidden;
    flex-shrink: 0;
    background: #8875F5;
    border: 1px solid var(--border-color);
  }

  #rp-image { width: 100%; height: 100%; object-fit: cover; }
  
  .rp-info { flex: 1; min-width: 0; }
  #rp-title {
    font-size: 15px;
    font-weight: 600;
    line-height: 1.4;
    margin: 0 0 4px 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    color: var(--text-color);
  }
  #rp-content:hover #rp-title { color: #8875F5; }
  #rp-date { font-size: 11px; opacity: 0.5; color: var(--text-color); }
</style>

<div id="random-post-daily">
  <svg class="rp-ornament orn-tl" viewbox="0 0 100 100"><path d="M0 0v100c0-55.2 44.8-100 100-100H0zm20 20c0 33.1 26.9 60 60 60V20H20z" opacity=".2"/><path d="M5 5v40c0-19.3 15.7-35 35-35H5zm10 10c0 11 9 20 20 20V15H15z"/></path></path></svg>
  <svg class="rp-ornament orn-br" viewbox="0 0 100 100"><path d="M0 0v100c0-55.2 44.8-100 100-100H0zm20 20c0 33.1 26.9 60 60 60V20H20z" opacity=".2"/><path d="M5 5v40c0-19.3 15.7-35 35-35H5zm10 10c0 11 9 20 20 20V15H15z"/></path></path></svg>
  
  <div class="rp-inner">
    <div class="rp-header">Postingan Pilihan Hari Ini</div>
    <a id="rp-content" href="#">
      <div class="rp-img-frame">
        <img id="rp-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="Thumbnail" />
      </div>
      <div class="rp-info">
        <h3 id="rp-title">Memuat arsip...</h3>
        <span id="rp-date"></span>
      </div>
    </a>
  </div>
</div>

<script>
(function() {
  const isHomepage = window.location.pathname === '/' || window.location.pathname === '/index.html' || window.location.pathname === '';
  if (!isHomepage) return;

  async function fetchRandomPost() {
    try {
      // Ambil total jumlah postingan
      const resTotal = await fetch(`/feeds/posts/summary?alt=json&max-results=0`);
      const dataTotal = await resTotal.json();
      const totalPosts = parseInt(dataTotal.feed.openSearch$totalResults.$t);

      // Hanya berganti sekali sehari
      const today = new Date();
      const seed = today.getFullYear() * 1000 + (today.getMonth() + 1) * 100 + today.getDate();
      const pseudoRandom = (Math.abs(Math.sin(seed) * 10000) % 1);
      
      // Ambil indeks acak 
      const safeTotal = totalPosts > 10 ? totalPosts - 5 : totalPosts; 
      const randomIndex = Math.floor(pseudoRandom * safeTotal) + 1;

      // Ambil satu postingan berdasarkan nomor urut (start-index)
      const resPost = await fetch(`/feeds/posts/summary?alt=json&start-index=${randomIndex}&max-results=1`);
      const dataPost = await resPost.json();
      
      if (dataPost.feed.entry && dataPost.feed.entry.length > 0) {
        const entry = dataPost.feed.entry[0];
        const title = entry.title.$t;
        const url = entry.link.find(l => l.rel === 'alternate').href;
        const date = new Date(entry.published.$t).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
        
        // Deteksi Gambar (Otomatis ke s200 agar tajam)
        let imgUrl = 'https://placehold.co/200x200/8875F5/ffffff?text=>_<';
        if (entry.media$thumbnail) {
          imgUrl = entry.media$thumbnail.url.replace(/\/s72\-c/, "/s200");
        }

        document.getElementById('rp-title').innerText = title;
        document.getElementById('rp-content').href = url;
        document.getElementById('rp-date').innerText = date;
        document.getElementById('rp-image').src = imgUrl;
        document.getElementById('random-post-daily').style.display = 'block';
      }
    } catch (e) {
      console.error("Widget Error:", e);
    }
  }

  fetchRandomPost();
})();
</script>
