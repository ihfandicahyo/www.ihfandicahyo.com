<style>
  /* Desain Glassmorphism & dukungan untuk MedianUI */
  .voc-glass-wrapper {
    position: relative;
    margin: 1.5rem 0;
    padding: 1.5rem;
    border-radius: 12px;
    background-color: rgba(150, 150, 150, 0.08);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid var(--border-color, rgba(128, 128, 128, 0.2));
    font-family: var(--font-body, 'Inter', sans-serif);
  }
  
  .voc-title {
    text-align: center;
    color: var(--title-color, inherit) !important;
    margin-bottom: 1rem;
    font-weight: 700;
  }
  
  .voc-status {
    text-align: center;
    font-size: 0.85rem;
    color: var(--text-color, inherit) !important;
    margin-bottom: 1rem;
    opacity: 0.8;
  }

  /* Banner Total Kata */
  .voc-total-banner {
    background-color: rgba(136, 117, 245, 0.15);
    padding: 12px;
    border-radius: 8px;
    text-align: center;
    margin-bottom: 1rem;
    color: #8875F5;
    font-size: 1.05rem;
  }

  /* Header Kolom (No, Kata, Jumlah) */
  .voc-header {
    display: flex;
    align-items: center;
    padding: 10px;
    border-bottom: 2px solid var(--border-color, rgba(128, 128, 128, 0.3));
    font-weight: 700;
    color: var(--title-color, inherit);
    margin-bottom: 5px;
  }
  
  .voc-item {
    display: flex;
    align-items: center;
    padding: 10px;
    border-bottom: 1px solid var(--border-color, rgba(128, 128, 128, 0.15));
    transition: background-color 0.2s ease;
  }

  .voc-item:hover {
    background-color: rgba(136, 117, 245, 0.08);
    border-radius: 8px;
  }

  /* Mengatur lebar masing-masing kolom agar sejajar */
  .voc-col-no {
    width: 70px;
    font-weight: 600;
    opacity: 0.8;
  }

  .voc-col-word {
    flex: 1;
  }
  
  .voc-word-link { 
    color: var(--text-color, inherit) !important; 
    font-weight: 600; 
    text-transform: capitalize; 
    text-decoration: none; 
    transition: color 0.2s ease;
  }

  .voc-word-link:hover {
    color: #8875F5 !important;
    text-decoration: underline;
  }
  
  .voc-count { 
    color: #8875F5 !important; 
    font-weight: 700; 
    font-size: 0.85rem;
    background-color: rgba(136, 117, 245, 0.1);
    padding: 4px 10px;
    border-radius: 12px;
    text-align: right;
  }
  
  .voc-hidden { display: none !important; }
  
  /* Loading Spinner */
  .voc-loader {
    width: 32px; height: 32px;
    border: 3px solid var(--border-color, rgba(128, 128, 128, 0.2));
    border-top: 3px solid #8875F5;
    border-radius: 50%;
    animation: voc-spin 0.8s linear infinite;
    margin: 0 auto 10px;
  }
  @keyframes voc-spin { to { transform: rotate(360deg); } }
</style>

<div class="voc-glass-wrapper">
  <div id="voc-loading-area">
    <div class="voc-loader" id="voc-spinner-icon"></div>
    <div class="voc-status" id="voc-progress">Memulai analisis arsip...</div>
  </div>

  <div class="voc-hidden" id="voc-result-area">
    <h3 class="voc-title">Daftar Kosa Kata</h3>
    <div id="voc-total-area"></div> 
    
    <div class="voc-header">
      <div class="voc-col-no">No</div>
      <div class="voc-col-word">Kata</div>
      <div>Jumlah</div>
    </div>

    <div id="voc-output"></div>
  </div>
</div>

<script>
(function() {
  let allWordsMap = {};
  let postsProcessed = 0;
  const startIndex = 1;
  const maxResultsPerPage = 150; 

  // Daftar kata yang diabaikan (Stop Words)
  const stopWords = [
    "postingan", "asli", "tanggal", "publikasikan", "januari", "februari", "maret", "april", "mei", "juni", "juli", "agustus", "september", "oktober", "november", "desember", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022", "2023", "2024", "2025"
  ];

  async function fetchAllPosts(index) {
    const progressEl = document.getElementById('voc-progress');
    progressEl.textContent = `Menyisir postingan ke-${index} dan seterusnya...`;

    try {
      const response = await fetch(`/feeds/posts/default?alt=json&start-index=${index}&max-results=${maxResultsPerPage}`);
      const data = await response.json();
      const entries = data.feed.entry || [];
      
      if (entries.length > 0) {
        processEntries(entries);
        postsProcessed += entries.length;
        await fetchAllPosts(index + entries.length);
      } else {
        finalize();
      }
    } catch (err) {
      console.error("Proses terhenti:", err);
      finalize(); 
    }
  }

  function processEntries(entries) {
    entries.forEach(entry => {
      const parser = new DOMParser();
      const doc = parser.parseFromString(entry.content.$t, 'text/html');
      const cleanText = doc.body.textContent || "";
      const words = cleanText.toLowerCase().match(/\b[a-z]{3,}\b/g);

      if (words) {
        words.forEach(word => {
          if (!stopWords.includes(word)) {
            allWordsMap[word] = (allWordsMap[word] || 0) + 1;
          }
        });
      }
    });
  }

  function finalize() {
    // Menghitung Total Semua Kata
    let totalAllWords = 0;
    for (let word in allWordsMap) {
      totalAllWords += allWordsMap[word];
    }

    // Mengurutkan dan mengambil 8000 teratas
    const sorted = Object.entries(allWordsMap)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 10000); 

    const output = document.getElementById('voc-output');
    const totalArea = document.getElementById('voc-total-area');
    
    if(sorted.length > 0) {
      // Menampilkan Total Kata dengan format angka Indonesia (misal: 15.000)
      totalArea.innerHTML = `
        <div class="voc-total-banner">
          <strong>Total Keseluruhan Kata:</strong> ${totalAllWords.toLocaleString('id-ID')}
        </div>
      `;

      // Menambahkan parameter 'index' pada map() untuk penomoran
      output.innerHTML = sorted.map(([word, count], index) => `
        <div class="voc-item">
          <div class="voc-col-no">${index + 1}.</div>
          <div class="voc-col-word">
            <a href="https://www.ihfandicahyo.com/search?q=${word}&m=1" target="_blank" class="voc-word-link" title="Cari kata '${word}' di blog">
              ${word}
            </a>
          </div>
          <div class="voc-count">${count.toLocaleString('id-ID')} Kali</div>
        </div>
      `).join('');
    } else {
      totalArea.innerHTML = "";
      output.innerHTML = "<div style='text-align:center;'>Tidak ada kosa kata yang ditemukan.</div>";
    }

    document.getElementById('voc-spinner-icon').classList.add('voc-hidden');
    document.getElementById('voc-progress').textContent = `Selesai! Berhasil membaca ${postsProcessed} postingan.`;
    document.getElementById('voc-result-area').classList.remove('voc-hidden');
  }

  document.addEventListener("DOMContentLoaded", () => fetchAllPosts(startIndex));
})();
</script>
